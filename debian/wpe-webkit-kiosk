#!/bin/bash
# WPE Kiosk launcher â€” reads config and starts the kiosk binary
set -euo pipefail

PREFIX=/opt/wpe-webkit-kiosk
CONFIG=/etc/wpe-webkit-kiosk/config

# Defaults
URL="https://wpewebkit.org"
INSPECTOR_PORT="8080"
INSPECTOR_HTTP_PORT="8090"
CURSOR_VISIBLE="true"

# Read config
if [ -f "$CONFIG" ]; then
    # shellcheck source=/dev/null
    . "$CONFIG"
fi

# Library paths
ARCH=$(dpkg-architecture -qDEB_HOST_MULTIARCH)
export LD_LIBRARY_PATH="${PREFIX}/lib/${ARCH}:${PREFIX}/lib:${LD_LIBRARY_PATH:-}"
export XDG_DATA_DIRS="${PREFIX}/share:${XDG_DATA_DIRS:-/usr/local/share:/usr/share}"

# WPEPlatform module path
export WPE_PLATFORM_MODULE_DIR="${PREFIX}/lib/${ARCH}/wpe-platform-2.0/modules"

# Remote inspector
export WEBKIT_INSPECTOR_SERVER="0.0.0.0:${INSPECTOR_PORT}"
export WEBKIT_INSPECTOR_HTTP_SERVER="0.0.0.0:${INSPECTOR_HTTP_PORT}"

# Cursor visibility
export WPE_KIOSK_CURSOR_VISIBLE="${CURSOR_VISIBLE}"

exec "${PREFIX}/bin/wpe-webkit-kiosk-bin" "$URL"
